// å¢å¼ºç‰ˆbackground.js - ã€æœ€ç»ˆæ™ºèƒ½åˆ†ç±»ç‰ˆ - æ›´æ–°Promptæ¨¡æ¿ã€‘

console.log('ğŸš€ AIæ‘˜è¦åŠ©æ‰‹ - å¢å¼ºç‰ˆæœ¬å·²åŠ è½½');

// ã€å·²æ›´æ–°ã€‘æ‘˜è¦æ¨¡æ¿å®šä¹‰
const SUMMARY_TEMPLATES = {
  "é€šç”¨æ¨¡æ¿": "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ–‡ç« æ‘˜è¦åŠ©æ‰‹ã€‚è¯·å¯¹ç»™å®šçš„æ–‡æœ¬å†…å®¹è¿›è¡Œç®€æ´ã€å‡†ç¡®çš„æ‘˜è¦ï¼Œçªå‡ºä¸»è¦è§‚ç‚¹å’Œå…³é”®ä¿¡æ¯ã€‚æ‘˜è¦é•¿åº¦æ§åˆ¶åœ¨600å­—ä»¥å†…ï¼Œä½¿ç”¨ä¸­æ–‡å›å¤ï¼Œè¾“å‡ºæ ¼å¼ç¾è§‚æ˜“è¯»ã€‚ã€‚",
  "Claude CEOæ¡†æ¶": "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ–‡ç« æ‘˜è¦åŠ©æ‰‹ã€‚è¯·æ ¹æ®claudeé¦–å¸­æ‰§è¡Œå®˜çš„äº§å“åˆ†ææ¡†æ¶ï¼Œå¯¹ç»™å®šçš„æ–‡æœ¬å†…å®¹è¿›è¡Œç®€æ´ã€å‡†ç¡®çš„æ‘˜è¦ï¼Œçªå‡ºä¸»è¦è§‚ç‚¹å’Œå…³é”®ä¿¡æ¯ï¼ˆå½“ç„¶ï¼Œä½ ä¸è¦éè¦æŠŠæ–‡ç« å’Œç»™å®šçš„äº§å“åˆ†ææ¡†æ¶æ‰¯ä¸Šå…³ç³»ï¼Œå¦‚æœå®Œå…¨æ‰¯ä¸ä¸Šå…³ç³»çš„è¯ï¼Œä½ åªéœ€è¦æ€»ç»“æ–‡ç« è§‚ç‚¹å³å¯ã€‚ï¼‰ã€‚æ‘˜è¦é•¿åº¦æ§åˆ¶åœ¨600å­—ä»¥å†…ï¼Œä½¿ç”¨ä¸­æ–‡å›å¤ï¼Œè¾“å‡ºæ ¼å¼ç¾è§‚æ˜“è¯»ã€‚claudeé¦–å¸­æ‰§è¡Œå®˜äº§å“åˆ†ææ¡†æ¶ï¼š \n\n1. æ ¸å¿ƒè½¬å˜ï¼šç“¶é¢ˆä»â€œæŠ€æœ¯å®ç°â€è½¬å‘â€œæˆ˜ç•¥å†³ç­–â€\nAIè®©â€œåšå‡ºäº§å“â€å˜å¾—æå…¶å»‰ä»·å’Œå¿«é€Ÿï¼Œè§£å†³äº†è¿‡å»çš„æ‰§è¡Œç“¶é¢ˆã€‚ç°åœ¨ï¼Œæ–°çš„ç“¶é¢ˆåœ¨äºâ€œåšä»€ä¹ˆâ€â€”â€”å³å¦‚ä½•åšå‡ºæ­£ç¡®çš„æˆ˜ç•¥é€‰æ‹©ã€éªŒè¯ç”¨æˆ·ä»·å€¼å’Œç¡®å®šä¼˜å…ˆçº§ã€‚\n\n2. äº§å“ç»ç†è§’è‰²â€œå‡ç»´â€ï¼šä»é¡¹ç›®æ‰§è¡Œè€…åˆ°æˆ˜ç•¥æŒ‡æŒ¥å®˜\nAIæ¥ç®¡äº†å¤§é‡çš„æ‰§è¡Œå·¥ä½œï¼Œäº§å“ç»ç†å¿…é¡»å‘ä¸Šæ¸¸ç§»åŠ¨ï¼Œä¸“æ³¨äºæ›´é«˜å±‚æ¬¡çš„æˆ˜ç•¥ä»»åŠ¡ã€‚å·¥ä½œé‡å¿ƒä¸å†æ˜¯æ¨åŠ¨åŠŸèƒ½å¼€å‘ï¼Œè€Œæ˜¯ä¸AIåä½œï¼Œå®šä¹‰æ­£ç¡®çš„äº§å“æ–¹å‘ã€‚\n\n3. ä¸‰å¤§å…³é”®æ–°èƒ½åŠ›ï¼š\n\nç³»ç»ŸåŒ–æ€ç»´ï¼šå…³æ³¨æ•´ä½“æ¶æ„ä¸æˆ˜ç•¥å¸ƒå±€ï¼Œè€Œéå­¤ç«‹åŠŸèƒ½ã€‚\n\nç§‘å­¦å®éªŒï¼šåˆ©ç”¨å¿«é€Ÿè¿­ä»£èƒ½åŠ›ï¼Œè®¾è®¡æœ‰æ•ˆå®éªŒæ¥éªŒè¯å‡è®¾ã€‚\n\næˆ˜ç•¥åˆ¤æ–­ï¼šåœ¨AIæä¾›çš„æµ·é‡å¯èƒ½æ€§ä¸­ï¼Œåšå‡ºæ˜æ™ºçš„â€œåšä»€ä¹ˆâ€ä¸â€œä¸åšä»€ä¹ˆâ€çš„å†³ç­–ã€‚\n\n4. äººç±»ä¸å¯æ›¿ä»£çš„ä»·å€¼ï¼š\nåœ¨AIæ—¶ä»£ï¼Œäººç±»çš„ç‹¬ç‰¹ä»·å€¼åœ¨äºï¼š\n\næå‡æ˜“ç”¨æ€§ï¼šå°†å¤æ‚æŠ€æœ¯è½¬åŒ–ä¸ºæ™®é€šäººèƒ½ç”¨çš„äº§å“ã€‚\n\nä»·å€¼åˆ¤æ–­ï¼šåšå‡ºè¶…è¶Šæ•°æ®å’Œé€»è¾‘çš„ã€åŸºäºå•†ä¸šå’Œäººæ–‡çš„æˆ˜ç•¥é€‰æ‹©ã€‚\n\nå¼•é¢†æ„¿æ™¯ï¼šæ¢ç´¢å¹¶å±•ç¤ºæŠ€æœ¯åº”ç”¨çš„æœªæ¥å¯èƒ½æ€§ã€‚\n\nç»“è®ºï¼š æœªæ¥æœ€é‡è¦çš„â€œå…ƒæŠ€èƒ½â€æ˜¯ä¸AIé«˜æ•ˆåä½œçš„èƒ½åŠ›ã€‚è¿™è¦æ±‚äººç±»ä»è¢«åŠ¨çš„å·¥å…·ä½¿ç”¨è€…ï¼Œè½¬å˜ä¸ºä¸»åŠ¨çš„ã€ä¸AIå…±åŒæ€è€ƒå’Œå†³ç­–çš„â€œé©¾é©¶å‘˜â€ã€‚",
  "Anthropic CPOæ¡†æ¶": "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ–‡ç« æ‘˜è¦åŠ©æ‰‹ã€‚è¯·æ ¹æ®Anthropic é¦–å¸­äº§å“å®˜çš„äº§å“åˆ†ææ¡†æ¶ï¼Œå¯¹ç»™å®šçš„æ–‡æœ¬å†…å®¹è¿›è¡Œç®€æ´ã€å‡†ç¡®çš„æ‘˜è¦ï¼Œçªå‡ºä¸»è¦è§‚ç‚¹å’Œå…³é”®ä¿¡æ¯ï¼ˆå½“ç„¶ï¼Œä½ ä¸è¦éè¦æŠŠæ–‡ç« å’Œç»™å®šçš„äº§å“åˆ†ææ¡†æ¶æ‰¯ä¸Šå…³ç³»ï¼Œå¦‚æœå®Œå…¨æ‰¯ä¸ä¸Šå…³ç³»çš„è¯ï¼Œä½ åªéœ€è¦æ€»ç»“æ–‡ç« è§‚ç‚¹å³å¯ã€‚ï¼‰ã€‚æ‘˜è¦é•¿åº¦æ§åˆ¶åœ¨600å­—ä»¥å†…ï¼Œä½¿ç”¨ä¸­æ–‡å›å¤ï¼Œè¾“å‡ºæ ¼å¼ç¾è§‚æ˜“è¯»ã€‚è¿™é‡Œæ˜¯ Anthropic é¦–å¸­äº§å“å®˜ Mike Krieger äº§å“åˆ†ææ¡†æ¶çš„ç®€æ´æ€»ç»“ï¼š\n\næ ¸å¿ƒè®ºç‚¹ï¼šAI é¢†åŸŸçš„æŒä¹…ç«äº‰ä¼˜åŠ¿å·²è¶…è¶Šæ¨¡å‹æ€§èƒ½ï¼Œå†³å®šæ€§å› ç´ åœ¨äºäº§å“ã€äººæ‰å’Œå¸‚åœºç­–ç•¥çš„ç»“åˆã€‚\n\n1. ä»·å€¼åˆ›é€ æ¡†æ¶ï¼šåœ¨äº¤å‰ç‚¹ä¸Šå–èƒœ\nçœŸæ­£çš„æŒä¹…ä»·å€¼å¹¶éæ¥è‡ªé€šç”¨æ¨¡å‹ï¼Œè€Œæ˜¯åœ¨äºä¸‰ä¸ªè¦ç´ çš„äº¤é›†ï¼š\n\nå·®å¼‚åŒ–å¸‚åœºç­–ç•¥ (Go-to-Market)ï¼šå¦‚ä½•è¿›å…¥å¸‚åœºã€‚\n\nç‰¹å®šè¡Œä¸šçŸ¥è¯† (Vertical Expertise)ï¼šæ·±è€•é‡‘èã€æ³•å¾‹ã€åŒ»ç–—ç­‰é«˜å£å’é¢†åŸŸã€‚\n\nç‹¬ç‰¹æ•°æ® (Unique Data)ï¼šæ‹¥æœ‰ä¸“æœ‰æ•°æ®é›†ã€‚\n\n2. AI äº§å“è®¾è®¡åŸåˆ™ï¼šä¸ºä¸ç¡®å®šæ€§è€Œè®¾è®¡\næ ¸å¿ƒæŒ‘æˆ˜ï¼šåœ¨â€œå±•ç¤ºæœªæ¥â€å’Œâ€œå…‘ç°å½“å‰èƒ½åŠ›â€ä¹‹é—´å–å¾—å¹³è¡¡ï¼Œé¿å…å› è¿‡åº¦æ‰¿è¯ºè€Œç ´åç”¨æˆ·ä¿¡ä»»ã€‚\n\nå·®å¼‚åŒ–å…³é”®ï¼šAI äº§å“çš„å“ç‰Œå¿ è¯šåº¦æ¥è‡ªäºæ¨¡å‹çš„â€œä¸ªæ€§â€å’Œâ€œæ°›å›´â€ï¼Œä»¥åŠå›´ç»•æ¨¡å‹æ„å»ºçš„ç”¨æˆ·ä½“éªŒï¼Œè€Œä¸çº¯ç²¹æ˜¯åŠŸèƒ½ã€‚\n\næ–°è®¾è®¡èŒƒå¼ï¼šäº§å“ã€è®¾è®¡å’Œå·¥ç¨‹å›¢é˜Ÿå¿…é¡»ä¸ºéç¡®å®šæ€§ç³»ç»Ÿè¿›è¡Œè®¾è®¡ï¼Œå°†æ¨¡å‹è¯„æµ‹å’Œæç¤ºå·¥ç¨‹èå…¥äº§å“å¼€å‘æ ¸å¿ƒã€‚\n\n3. ç«äº‰ä¼˜åŠ¿çš„ä¸‰å¤§æ”¯æŸ±\nåœ¨åŸºç¡€æ¨¡å‹å±‚é¢ï¼Œå»ºç«‹æŠ¤åŸæ²³éœ€è¦æŠ•èµ„äºï¼š\n\né¡¶å°–äººæ‰ (Talent)ï¼šäººæ‰æ˜¯å‘ç°æ­£ç¡®çªç ´æ–¹å‘çš„æ ¹æœ¬ã€‚\n\næ¨¡å‹å·®å¼‚åŒ– (Differentiation)ï¼šå¼ºåŒ–æ¨¡å‹ç‹¬ç‰¹çš„â€œä¸ªæ€§â€å’Œèƒ½åŠ›ä¼˜åŠ¿ï¼Œæœªæ¥æ¨¡å‹ä¼šå˜å¾—æ›´ä¸ç›¸åŒè€Œéè¶‹åŒã€‚\n\næ·±åº¦åˆä½œ (Partnerships)ï¼šè¶…è¶Šç®€å•çš„ API è°ƒç”¨ï¼Œæˆä¸ºå®¢æˆ·çš„â€œAI æˆ˜ç•¥åˆä½œä¼™ä¼´â€ï¼Œå…±åŒè®¾è®¡è§£å†³æ–¹æ¡ˆã€‚\n\n4. æœ€ç»ˆç›®æ ‡ï¼šè¿½æ±‚æ·±åº¦äº§å“å¸‚åœºå¥‘åˆåº¦ (Deep PMF)\næ¸…é†’è®¤çŸ¥ï¼šæ‰¿è®¤å½“å‰äº§å“çš„å¿«é€Ÿé‡‡ç”¨ï¼ˆAdoptionï¼‰é¢†å…ˆäºçœŸæ­£çš„äº§å“å¸‚åœºå¥‘åˆåº¦ï¼ˆPMFï¼‰ã€‚ç”¨æˆ·ç›®å‰æ˜¯ä¸ºæ¨¡å‹è€Œæ¥ï¼Œä½†è¿™ä¸å¯æŒç»­ã€‚\n\nè¡Œä¸šæ ¸å¿ƒæŒ‘æˆ˜ï¼šå°† AI ä»ä¸€ä¸ªå¶å°”ä½¿ç”¨çš„â€œæµ…ä»·å€¼â€å·¥å…·ï¼ˆå†™è¯—ã€å†™ä¿¡ï¼‰ï¼Œè½¬å˜ä¸ºæ— ç¼èå…¥ç”¨æˆ·æ—¥å¸¸å·¥ä½œæµç¨‹ã€ä¸å¯æˆ–ç¼ºçš„â€œæ·±ä»·å€¼â€å·¥å…·ã€‚\n\nç»„ç»‡æ•æ·æ€§ï¼šå³ä½¿å…¬å¸è§„æ¨¡æ‰©å¤§ï¼Œä¹Ÿå¿…é¡»ä¿æŒåˆåˆ›å…¬å¸çš„æ€ç»´å’Œè¿­ä»£é€Ÿåº¦ï¼Œæ‰“ç ´ç»„ç»‡å£å’ï¼Œå¿«é€Ÿåä½œã€‚",
  "Peter Dengæ¡†æ¶": "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ–‡ç« æ‘˜è¦åŠ©æ‰‹ã€‚è¯·æ ¹æ®Peter Deng çš„äº§å“åˆ†ææ¡†æ¶ï¼Œå¯¹ç»™å®šçš„æ–‡æœ¬å†…å®¹è¿›è¡Œç®€æ´ã€å‡†ç¡®çš„æ‘˜è¦ï¼Œçªå‡ºä¸»è¦è§‚ç‚¹å’Œå…³é”®ä¿¡æ¯ï¼ˆå½“ç„¶ï¼Œä½ ä¸è¦éè¦æŠŠæ–‡ç« å’Œç»™å®šçš„äº§å“åˆ†ææ¡†æ¶æ‰¯ä¸Šå…³ç³»ï¼Œå¦‚æœå®Œå…¨æ‰¯ä¸ä¸Šå…³ç³»çš„è¯ï¼Œä½ åªéœ€è¦æ€»ç»“æ–‡ç« è§‚ç‚¹å³å¯ã€‚ï¼‰ã€‚æ‘˜è¦é•¿åº¦æ§åˆ¶åœ¨600å­—ä»¥å†…ï¼Œä½¿ç”¨ä¸­æ–‡å›å¤ï¼Œè¾“å‡ºæ ¼å¼ç¾è§‚æ˜“è¯»ã€‚ä»¥ä¸‹æ˜¯ Peter Deng çš„äº§å“ã€ç»„ç»‡ä¸é¢†å¯¼åŠ›æ¡†æ¶çš„ç®€æ´æ€»ç»“ã€‚\n\nè¯¥æ¡†æ¶çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šåœ¨AIæ—¶ä»£ï¼ŒæŠ€æœ¯æœ¬èº«å¹¶éæŠ¤åŸæ²³ï¼ŒçœŸæ­£çš„æŠ¤åŸæ²³æ˜¯ç”±å…·å¤‡å®¡ç¾ä¸åˆ¤æ–­åŠ›çš„äººæ‰æ‰€æ„å»ºçš„ã€æ·±åº¦æ•´åˆäº†æ•°æ®ä¸å·¥ä½œæµçš„â€œç³»ç»Ÿâ€ã€‚è¶…çº§æ™ºèƒ½çš„ä»·å€¼ä¸åœ¨äºè‡ªåŠ¨åŒ–ï¼Œè€Œåœ¨äºæ¿€å‘äººç±»çš„åˆ›é€ åŠ›ã€‚\n\n1. AI æ—¶ä»£çš„ä»·å€¼åˆ›é€ æ¡†æ¶\næ ¸å¿ƒè®ºç‚¹ï¼šAI é¢†åŸŸæœ€è¢«é«˜ä¼°çš„æ˜¯â€œæ™ºèƒ½æœ¬èº«â€ï¼Œæœ€è¢«ä½ä¼°çš„æ˜¯äº§å“è®¾è®¡ã€‚ç«äº‰çš„å…³é”®ä¸æ˜¯æ¨¡å‹å¼ºå¼±ï¼Œè€Œæ˜¯è°èƒ½è·‘é€š â€œæ¨¡å‹ â†’ Agent â†’ å·¥ä½œæµ â†’ ä»·å€¼é—­ç¯â€ çš„ç³»ç»Ÿé“¾æ¡ã€‚\n\nAI åˆ›ä¸šä¸¤å¤§æ”¯æŸ±ï¼š\n\næ•°æ®é£è½® (Data Flywheel)ï¼šè·å–å¹¶æŒç»­ç”Ÿæˆç‹¬ç‰¹çš„ã€ä¸“æœ‰çš„æ•°æ®ï¼Œä»¥ä¸æ–­ä¼˜åŒ–æ¨¡å‹å’Œäº§å“ã€‚\n\nå·¥ä½œæµæ•´åˆ (Workflow Integration)ï¼šå°†äº§å“æ·±åº¦åµŒå…¥å‚ç›´è¡Œä¸šæˆ–ä¸ªäººç”¨æˆ·çš„æ ¸å¿ƒå·¥ä½œæµç¨‹ä¸­ï¼Œä½¿å…¶å˜å¾—ä¸å¯æˆ–ç¼ºï¼Œä»è€Œæ”¹å˜ç”¨æˆ·ä¹ æƒ¯ã€‚\n\näº§å“æŠ€è‰º (Product Craft) çš„å›å½’ï¼šéšç€åŸºç¡€æ¨¡å‹èƒ½åŠ›è¶‹åŒï¼Œèƒ½æ‰“åŠ¨ç”¨æˆ·çš„ç²¾å¦™äº§å“ç»†èŠ‚ã€ä»¤äººæ„‰æ‚¦çš„ä½“éªŒå’Œæµç•…çš„å·¥ä½œæµï¼Œå°†æˆä¸ºæœ€ç»ˆçš„å·®å¼‚åŒ–ä¼˜åŠ¿ã€‚\n\n2. ä» 0 åˆ° 100 çš„ç³»ç»Ÿæ€§æ€ç»´\né˜¶æ®µåˆ’åˆ†ï¼š\n\n0 â†’ 1 é˜¶æ®µï¼šæ ¸å¿ƒä»»åŠ¡æ˜¯å¯»æ‰¾äº§å“å¸‚åœºå¥‘åˆåº¦ï¼ˆPMFï¼‰ã€‚\n\n1 â†’ 100 é˜¶æ®µï¼šæ ¸å¿ƒä»»åŠ¡æ˜¯æ„å»ºèƒ½å¤ŸæŒç»­åŠ é€Ÿçš„ç³»ç»Ÿã€‚æ­¤æ—¶éœ€è¦â€œæ…¢ä¸‹æ¥æ‰èƒ½æ›´å¿«â€ï¼Œè¿›è¡Œå‰ç»æ€§è§„åˆ’å’Œæ¶æ„è®¾è®¡ï¼Œè€Œéç®€å•åœ°å¿«é€Ÿè¿­ä»£ã€‚\n\nå…³é”®å·¥å…·ï¼šå»ºç«‹å¢é•¿å›¢é˜Ÿ\n\nå¢é•¿å›¢é˜Ÿçš„ä»·å€¼ä¸ä»…åœ¨äºé©±åŠ¨å¢é•¿æ•°å­—ï¼Œæ›´åœ¨äºå…¶â€œäºŒé˜¶æ•ˆåº”â€ï¼šä»–ä»¬ä¼šé€šè¿‡æé—®å’Œå®éªŒï¼Œå€’é€¼æ•´ä¸ªç»„ç»‡å®ç°æ•°æ®é©±åŠ¨å’Œè¿è¥ä¸¥è°¨ï¼Œä¸ºè§„æ¨¡åŒ–å¢é•¿å¥ å®šåŸºç¡€ã€‚\n\n3. ç»„ç»‡ä¸å›¢é˜Ÿè®¾è®¡ï¼šâ€œæŠŠå›¢é˜Ÿå½“äº§å“æ¥æ‰“ç£¨â€\næ ¸å¿ƒç†å¿µï¼šæœ€æˆåŠŸçš„å›¢é˜Ÿæ˜¯èƒ½åŠ›äº’è¡¥ã€å……æ»¡å¥åº·å¼ åŠ›çš„â€œå¤ä»‡è€…è”ç›Ÿâ€ï¼Œè€ŒéåŒè´¨åŒ–çš„â€œåŠ³åŠ¨åŠ›â€ã€‚é¢†å¯¼è€…çš„å·¥ä½œæ˜¯è®¾è®¡è¿™ä¸ªå›¢é˜Ÿâ€œäº§å“â€ã€‚\n\näº”ç§äº§å“ç»ç†åŸå‹ (The 5 PM Archetypes)ï¼šé€šè¿‡æ‹›è˜è¿™äº”ç§ä¸åŒç‰¹è´¨çš„PMï¼Œæ¥æ„å»ºè§†é‡å…¨é¢ã€å†³ç­–å¹³è¡¡çš„å›¢é˜Ÿã€‚\n\næ¶ˆè´¹è€…å‹ (Consumer PM)ï¼šåŠä¸ªè®¾è®¡å¸ˆï¼Œæ³¨é‡ä½“éªŒã€ç»†èŠ‚å’Œå·¥è‰ºã€‚\n\nå¢é•¿å‹ (Growth PM)ï¼šåŠä¸ªæ•°æ®ç§‘å­¦å®¶ï¼Œä»¥æ•°æ®ä¸ºå¯¼å‘ï¼Œå……æ»¡æ€€ç–‘ç²¾ç¥ã€‚\n\nå•†ä¸šå‹ (Business PM)ï¼šåŠä¸ªMBAï¼Œä»å•†ä¸šæ¨¡å¼ã€æ¿€åŠ±æœºåˆ¶å’Œå¸‚åœºè§’åº¦æ€è€ƒã€‚\n\nå¹³å°å‹ (Platform PM)ï¼šæ“…é•¿ä¸ºä»–äººæ„å»ºå·¥å…·å’Œç³»ç»Ÿï¼Œæ€è€ƒæŠ½è±¡ä¸æ‰©å±•ã€‚\n\nç ”ç©¶/AIå‹ (Research/AI PM)ï¼šç ”ç©¶å‘˜ä¸PMçš„ç»“åˆä½“ï¼Œæ·±åº¦ç†è§£æŠ€æœ¯å¹¶å…·å¤‡äº§å“å“å‘³ã€‚\n\n4. é¢†å¯¼åŠ›ä¸æ‹›è˜å“²å­¦\næ‹›è˜ä¸¤å¤§ç§˜è¯€ï¼š\n\nâ€œå…­ä¸ªæœˆåŸåˆ™â€ (The 6-Month Rule)ï¼šç”¨äºç­›é€‰å…·å¤‡è‡ªä¸»æ€§ã€åˆ¤æ–­åŠ›å’Œä¸»åŠ¨æ€§çš„äººæ‰ã€‚â€œå¦‚æœå…­ä¸ªæœˆåï¼Œæˆ‘è¿˜å¾—å‘Šè¯‰ä½ è¯¥åšä»€ä¹ˆï¼Œé‚£å°±æ˜¯æˆ‘æ‹›é”™äººäº†ã€‚â€\n\næˆé•¿å‹æ€ç»´ (Growth Mindset)ï¼šè¿™æ˜¯ä»–åœ¨æœ€ç»ˆé¢è¯•è½®å”¯ä¸€è€ƒå¯Ÿçš„ç‰¹è´¨ã€‚ä»–ç›¸ä¿¡æŠ€èƒ½å¯ä»¥åŸ¹å…»ï¼Œä½†è‡ªçœã€ä¹äºæ¥å—åé¦ˆå’Œæ¸´æœ›è¿›æ­¥çš„å¿ƒæ€æ˜¯å›¢é˜ŸæˆåŠŸçš„â€œå…ƒâ€å› ç´ ã€‚\n\næ ¸å¿ƒç®¡ç†æŠ€å·§ï¼š\n\nå‘æŒ¥ä¼˜åŠ¿ï¼šå¸®åŠ©å›¢é˜Ÿæˆå‘˜å‘ç°å¹¶åˆ›é€ èƒ½æœ€å¤§åŒ–å…¶ç‹¬ç‰¹ä¼˜åŠ¿çš„å²—ä½ï¼ˆå¦‚ä¸ºJoanne Jiangåˆ›é€ â€œæ¨¡å‹è®¾è®¡å¸ˆâ€èŒä½ï¼‰ã€‚\n\né«˜æ•ˆæ²Ÿé€šå¾ªç¯ï¼šâ€œè¯´ä½ è¦åšä»€ä¹ˆï¼Œè¯´ä½ æ­£åœ¨åšï¼Œæœ€åè¯´ä½ å®Œæˆäº†ã€‚â€ è¿™æ˜¯ä¸€ä¸ªç¡®ä¿ç›®æ ‡å¯¹é½ã€åŒæ­¥è¿›å±•å¹¶é—­ç¯åé¦ˆçš„ç®€å•æŠ€å·§ã€‚\n\näº§å“ç¬¬ä¸€åŸåˆ™ï¼šå…±æƒ… (Empathy)\n\nå›å½’è®¾è®¡æ€ç»´çš„æœ¬æºï¼Œå¼ºè°ƒå¿…é¡»äº²èº«æ„Ÿå—ç”¨æˆ·çš„ç—›è‹¦ï¼Œè€Œä¸åªæ˜¯ç†è®ºä¸Šç†è§£ã€‚äº²è‡ªç”¨æˆ·è°ƒç ”ã€ä½“éªŒäº§å“ï¼ˆDogfoodingï¼‰æ˜¯ä¸å¯æ›¿ä»£çš„ï¼Œå› ä¸ºâ€œè½¶äº‹æ¯”æ•°æ®æ›´å¯ä¿¡â€ã€‚"
};

// åˆ›å»ºå³é”®èœå•
chrome.runtime.onInstalled.addListener(() => {
  console.log('ğŸ“‹ æ­£åœ¨åˆ›å»ºå³é”®èœå•...');
  chrome.contextMenus.create({
    id: "summarizeAndAddToFeishu",
    title: "è‡ªåŠ¨æ‘˜è¦å¹¶æ·»åŠ åˆ°é£ä¹¦è¡¨æ ¼",
    contexts: ["selection"]
  }, () => {
    if (chrome.runtime.lastError) {
      console.error('âŒ åˆ›å»ºå³é”®èœå•å¤±è´¥:', chrome.runtime.lastError);
    } else {
      console.log('âœ… å³é”®èœå•åˆ›å»ºæˆåŠŸ');
    }
  });
});

// å¤„ç†å³é”®èœå•ç‚¹å‡»
chrome.contextMenus.onClicked.addListener(async (info, tab) => {
  console.log('ğŸ–±ï¸ å³é”®èœå•è¢«ç‚¹å‡»:', info.menuItemId);
  if (info.menuItemId === "summarizeAndAddToFeishu") {
    console.log('ğŸ“ å¼€å§‹å¤„ç†æ‘˜è¦è¯·æ±‚...');
    const selectedText = info.selectionText;
    const pageUrl = tab.url;
    const pageTitle = tab.title;

    try {
      chrome.action.setBadgeText({ text: "å¤„ç†ä¸­" });
      chrome.action.setBadgeBackgroundColor({ color: "#4285f4" });
      
      const result = await chrome.storage.sync.get([
        'deepseekApiKey', 'defaultTemplate',
        'feishuAppId', 'feishuAppSecret', 'feishuTableUrl'
      ]);

      const template = result.defaultTemplate || 'é€šç”¨æ¨¡æ¿';
      
      console.log('ğŸ¤– å¼€å§‹è°ƒç”¨AIè¿›è¡Œæ™ºèƒ½åˆ†æ(æ‘˜è¦+åˆ†ç±»)...');
      const analysisResult = await getAiAnalysis(selectedText, result.deepseekApiKey, template);
      
      console.log('âœ… AIåˆ†æå®Œæˆ:');
      console.log(`   - æ™ºèƒ½åˆ†ç±»ç»“æœ: ${analysisResult.category}`);
      console.log(`   - ç”Ÿæˆæ‘˜è¦é•¿åº¦: ${analysisResult.summary.length}`);

      await addToFeishuTable(analysisResult.summary, pageUrl, pageTitle, analysisResult.category, result);

      chrome.action.setBadgeText({ text: "å®Œæˆ" });
      chrome.action.setBadgeBackgroundColor({ color: "#34a853" });
      setTimeout(() => chrome.action.setBadgeText({ text: "" }), 3000);

    } catch (error) {
      console.error('âŒ å¤„ç†å¤±è´¥:', error);
      chrome.notifications.create({
        type: 'basic', iconUrl: 'icons/icon48.png', 
        title: 'AIæ‘˜è¦åŠ©æ‰‹ - å¤„ç†å¤±è´¥', message: error.message
      });
      chrome.action.setBadgeText({ text: "é”™è¯¯" });
      chrome.action.setBadgeBackgroundColor({ color: "#ea4335" });
      setTimeout(() => chrome.action.setBadgeText({ text: "" }), 5000);
    }
  }
});

// å…¨æ–°çš„AIåˆ†æå‡½æ•°ï¼Œè¦æ±‚AIåŒæ—¶è¾“å‡ºåˆ†ç±»å’Œæ‘˜è¦
async function getAiAnalysis(text, apiKey, template) {
  // æ ¹æ®ç”¨æˆ·é€‰æ‹©çš„æ¨¡æ¿ï¼Œè·å–å¯¹åº”çš„è¯¦ç»†æ¡†æ¶æè¿°
  const frameworkDescription = SUMMARY_TEMPLATES[template] || SUMMARY_TEMPLATES["é€šç”¨æ¨¡æ¿"];

  const systemPrompt = `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ–‡ç« åˆ†æåŠ©æ‰‹ã€‚ä½ çš„ä»»åŠ¡æ˜¯åŒæ—¶å®Œæˆä»¥ä¸‹ä¸¤ä»¶äº‹ï¼š
1.  **åˆ†ç±»**ï¼šä»”ç»†é˜…è¯»æ–‡æœ¬ï¼Œåˆ¤æ–­å…¶æ ¸å¿ƒå†…å®¹å±äº "äº§å“ç±»"ã€"æŠ€æœ¯ç±»" è¿˜æ˜¯ "è¶‹åŠ¿ç±»" ä¸­çš„å“ªä¸€ä¸ªã€‚
2.  **æ‘˜è¦**ï¼šæ ¹æ®ç”¨æˆ·æŒ‡å®šçš„åˆ†ææ¡†æ¶ä¸ºæ–‡æœ¬ç”Ÿæˆä¸€æ®µ200-300å­—çš„ä¸“ä¸šæ‘˜è¦ã€‚

è¿™æ˜¯ç”¨æˆ·æŒ‡å®šçš„åˆ†ææ¡†æ¶æè¿°ï¼š
---
${frameworkDescription}
---

**é‡è¦æ ¼å¼è¦æ±‚**ï¼š
-   æ‘˜è¦å†…å®¹å¿…é¡»ä½¿ç”¨Markdownæ ¼å¼ã€‚
-   å…³é”®ä¿¡æ¯ç‚¹éœ€è¦åˆ†ç‚¹è®ºè¿°ï¼Œä½¿ç”¨é¡¹ç›®ç¬¦å·ï¼ˆä¾‹å¦‚ '*' æˆ– '-'ï¼‰ã€‚
-   å¯¹æ‘˜è¦ä¸­çš„æ ¸å¿ƒæœ¯è¯­æˆ–å…³é”®æ•°æ®è¿›è¡Œ**åŠ ç²—**å¤„ç†ï¼Œä»¥çªå‡ºé‡ç‚¹ã€‚

ä½ å¿…é¡»ä»¥ä¸€ä¸ªä¸¥æ ¼çš„JSONæ ¼å¼è¿”å›ä½ çš„åˆ†æç»“æœï¼Œæ ¼å¼å¦‚ä¸‹ï¼Œä¸è¦æœ‰ä»»ä½•å¤šä½™çš„æ–‡å­—è¯´æ˜ï¼š
{
  "category": "è¿™é‡Œå¡«å…¥ä½ åˆ¤æ–­å‡ºçš„åˆ†ç±»",
  "summary": "è¿™é‡Œå¡«å…¥ä½ ç”Ÿæˆçš„ã€ç¬¦åˆMarkdownæ ¼å¼è¦æ±‚çš„æ‘˜è¦"
}
`;

  const response = await fetch("https://api.deepseek.com/v1/chat/completions", {
    method: "POST",
    headers: { "Content-Type": "application/json", "Authorization": `Bearer ${apiKey}` },
    body: JSON.stringify({
      model: "deepseek-chat",
      response_format: { type: "json_object" }, // å¼ºåˆ¶è¦æ±‚è¿”å›JSON
      messages: [
        { role: "system", content: systemPrompt },
        { role: "user", content: `è¯·åˆ†æä»¥ä¸‹æ–‡æœ¬ï¼š\n\n${text}` }
      ],
    })
  });
  
  if (!response.ok) {
    throw new Error(`AIåˆ†æAPIé”™è¯¯: ${response.status}`);
  }
  
  const data = await response.json();
  const content = data.choices[0].message.content;

  try {
    const result = JSON.parse(content);
    if (!result.category || !result.summary) {
      throw new Error("AIè¿”å›çš„JSONæ ¼å¼ä¸å®Œæ•´ã€‚");
    }
    return result;
  } catch (e) {
    console.error("è§£æAIè¿”å›çš„JSONå¤±è´¥:", content);
    throw new Error("æ— æ³•è§£æAIçš„åˆ†æç»“æœï¼Œè¯·ç¨åé‡è¯•ã€‚");
  }
}

// å…¥å£å‡½æ•°ï¼Œç°åœ¨æ¥æ”¶AIåˆ¤æ–­å‡ºçš„category
async function addToFeishuTable(summary, pageUrl, pageTitle, category, config) {
  try {
    const { feishuAppId: appId, feishuAppSecret: appSecret, feishuTableUrl: tableUrl } = config;
    if (!appId || !appSecret || !tableUrl) throw new Error('é£ä¹¦é…ç½®ä¸å®Œæ•´');

    const accessToken = await getFeishuAccessToken(appId, appSecret);
    const tableInfo = getTableInfoFromUrl(tableUrl, appId);
    
    await addRecordToTable(accessToken, tableInfo, summary, pageUrl, pageTitle, category);
    
    console.log('âœ… æˆåŠŸæ·»åŠ è®°å½•åˆ°é£ä¹¦è¡¨æ ¼');
    chrome.notifications.create({
      type: 'basic', iconUrl: 'icons/icon48.png',
      title: 'AIæ‘˜è¦åŠ©æ‰‹', message: `æ–‡ç« å·²æ™ºèƒ½è¯†åˆ«ä¸º"${category}"å¹¶æ·»åŠ åˆ°é£ä¹¦ï¼`
    });
  } catch (error) {
    console.error('âŒ æ·»åŠ åˆ°é£ä¹¦è¡¨æ ¼å¤±è´¥:', error);
    throw error;
  }
}

// è·å–é£ä¹¦Tokençš„å‡½æ•°
async function getFeishuAccessToken(appId, appSecret) {
  const response = await fetch('https://open.feishu.cn/open-apis/auth/v3/tenant_access_token/internal', {
    method: 'POST', headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ app_id: appId, app_secret: appSecret })
  });
  const data = await response.json();
  if (data.code !== 0) throw new Error(`è·å–é£ä¹¦Tokenå¤±è´¥: ${data.msg}`);
  return data.tenant_access_token;
}

// ä»URLè§£æè¡¨æ ¼ä¿¡æ¯çš„å‡½æ•°
function getTableInfoFromUrl(tableUrl, appId) {
  try {
    const url = new URL(tableUrl);
    if (url.pathname.includes('/sheets/')) {
      const match = url.pathname.match(/\/sheets\/([^\/\?]+)/);
      const sheetId = url.searchParams.get('sheet');
      if (match && sheetId) {
        return { appId, type: 'sheets', spreadsheetId: match[1], sheetId };
      }
    }
    throw new Error('é“¾æ¥æ ¼å¼æ— æ³•è¯†åˆ«æˆ–ç¼ºå°‘sheetå‚æ•°');
  } catch (error) {
    throw new Error(`è§£æé“¾æ¥å¤±è´¥: ${error.message}`);
  }
}

// å†™å…¥é£ä¹¦è¡¨æ ¼çš„å‡½æ•°
async function addRecordToTable(accessToken, tableInfo, summary, pageUrl, pageTitle, category) {
  const currentTime = new Date().toLocaleString('zh-CN', { hour12: false });
  const originalInfo = `åŸæ–‡é“¾æ¥ï¼š${pageUrl}\n\næ–‡ç« æ ‡é¢˜ï¼š${pageTitle}\n\nåˆ†ææ—¶é—´ï¼š${currentTime}`;
  
  const { type, spreadsheetId, sheetId } = tableInfo;

  let endpoint, body;
  
  if (type === 'sheets') {
    endpoint = `https://open.feishu.cn/open-apis/sheets/v2/spreadsheets/${spreadsheetId}/values_append`;
    body = {
      valueRange: {
        range: sheetId,
        values: [ [category, originalInfo, summary] ] 
      }
    };
  } else {
    throw new Error(`å½“å‰é€»è¾‘ä»…æ”¯æŒç”µå­è¡¨æ ¼(Sheets)ï¼Œä¸æ”¯æŒç±»å‹: "${type}"`);
  }
  
  const response = await fetch(endpoint, {
    method: 'POST',
    headers: { 'Authorization': `Bearer ${accessToken}`, 'Content-Type': 'application/json' },
    body: JSON.stringify(body)
  });
  
  const responseData = await response.json();

  if (!response.ok || responseData.code !== 0) {
    throw new Error(`å†™å…¥é£ä¹¦å¤±è´¥: ${responseData.msg || 'æœªçŸ¥é”™è¯¯'}`);
  }
  console.log(`âœ… APIè°ƒç”¨æˆåŠŸ`);
}